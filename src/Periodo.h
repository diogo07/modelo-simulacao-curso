#ifndef __CURSO_PERIODO_H
#define __CURSO_PERIODO_H

#include <omnetpp.h>
#include "Aluno.h"

using namespace omnetpp;

class Periodo : public cSimpleModule {
    private:

//      CONF DA TURMA
        simsignal_t tamanhoFilaEspera;
        simsignal_t tamanhoTurma;

//      INFO DO PERIODO
        simsignal_t evadidosPorPeriodo[10];
        simsignal_t retidosPorPeriodo[10];

        simsignal_t evadidosPorSemestre[21];
        simsignal_t retidosPorSemestre[21];

//        simsignal_t evadidos_Semestre_periodo[21][10];
//        simsignal_t retidos_Semestre_periodo[21][10];


        simsignal_t evadidosSemestrePeriodo[21][10];
        simsignal_t retidosSemestrePeriodo[21][10];


        simsignal_t totalEvadidos;
        simsignal_t quantidadeEvadidosGeral;
        simsignal_t quantidadeRetidosGeral;

        virtual bool compare(Aluno * aluno1, Aluno * aluno2);
        virtual void adicionarNaTurma(Aluno *aluno);
        virtual void avaliarAluno(Aluno *aluno);
        virtual bool evadir(int semestre);
        virtual bool reter(int semestre);
        virtual void emitirDadosDoPeriodo();
        virtual void processarAluno(Aluno *aluno);
        virtual void registerSignalArray();

    public:
        virtual ~Periodo() override;

    protected:

//      ATRIBUTOS DE CONFIGURAÇÃO
        SimTime tempo;
        cQueue turma;
        cQueue filaEspera;
        int capacidadeTurma;
        int indice; // O ÍNDICE EQUIVALE AO PERÍODO, EX: INDICE 1 = 1º PERIODO
        int portaSaida;
        int portaSaidaInicialRetencao;
        int analiseCurso = 1; // 0 - GERAL, 1 - BSI, 2 - BCC
        int analiseTipo = 0; // 0 - POR PERIODO, 1 - POR SEMESTRE, 2 - SEMESTRE E PERIODO

//      ESPECÍFICOS
        int contadorDeAlunosNaTurma;

//      GERAL
        int retidosGeral;
        int evadidosGeral;


//      TESTES
        bool evadido = false;

/**
 *
 * METRICAS DE EVASÃO E RETENÇÃO USADOS NO MODELO
 *
 */


//      UFRPE


//      POR PERIODO
        double probDeEvasaoPeriodo [3][10] = {
                {0.36086999999999997, 0.17391299999999993, 0.07608899999999999, 0.03695799999999999, 0.019566, 0.023914, 0.014131, 0.007609, 0.006522, 0.004348},
//                {0.3552879999999999, 0.15568800000000002, 0.083832, 0.05189600000000001, 0.025948000000000002, 0.023952, 0.017964, 0.011976, 0.011976, 0.007984},
              {0.45170000000000005, 0.1185, 0.10769999999999999, 0.0324, 0.054000000000000006, 0, 0, 0.0108, 0, 0},
                {0.36754400000000004, 0.195703, 0.066827, 0.019094, 0.011935, 0.023868999999999998, 0.009548, 0.002387, 0.0, 0.0}
        };
        double probDeRetencaoPeriodo [3][10] = {
                {0.3858689999999999, 0.18587000000000004, 0.09891299999999999, 0.054348, 0.029348, 0.019566, 0.014131, 0.020653, 0.019566, 0.025001},
//                {0.401197, 0.183633, 0.097804, 0.05988, 0.021955999999999996, 0.013972, 0.015968, 0.017964, 0.017964, 0.045908000000000004},
                {0.5269, 0.172, 0.1183, 0.0431, 0.0108, 0, 0.0108, 0.0323, 0, 0.0216},
                {0.36754200000000004, 0.188544, 0.100239, 0.047733000000000005, 0.038187, 0.026254000000000003, 0.011934, 0.023866000000000002, 0.021480000000000003, 0.0}
        };


//      POR SEMESTRE
        double probDeEvasaoSemestre [3][21] = {
                { 0.14239100000000002, 0.131522, 0.08587, 0.10000000000000002, 0.057609, 0.05543499999999999, 0.033697, 0.017392, 0.027174999999999994, 0.016305, 0.008696, 0.013044, 0.011957, 0.002174, 0.005435, 0.006522, 0.003261, 0.002174, 0.002174, 0.001087, 0.0 },
                { 0.13772399999999999, 0.13373200000000002, 0.10179600000000001, 0.095808, 0.047904, 0.05788400000000001, 0.02994, 0.013972, 0.03992, 0.01996, 0.013972, 0.011976, 0.013972, 0.001996, 0.003992, 0.00998, 0.003992, 0.003992, 0.001996, 0.001996, 0.0 },
                { 0.147971, 0.128879, 0.066826, 0.105012, 0.06921300000000001, 0.052506000000000004, 0.038186000000000005, 0.021481, 0.011934, 0.011934, 0.002387, 0.014320999999999999, 0.009548, 0.002387, 0.007161, 0.002387, 0.002387, 0.0, 0.002387, 0.0, 0.0 }
        };

        double probDeRetencaoSemestre [3][21] = {
                { 0.269565, 0.251087, 0.117392, 0.052174000000000005, 0.034782, 0.025001, 0.017392, 0.015217999999999999, 0.018479000000000002, 0.01087, 0.01087, 0.006522, 0.003261, 0.001087, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.019565 },
                { 0.32335299999999995, 0.231537, 0.12175600000000002, 0.04391199999999999, 0.025948000000000002, 0.023952, 0.01996, 0.015968, 0.017964, 0.00998, 0.011976, 0.003992, 0.005988, 0.001996, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.017964 },
                { 0.205251, 0.274463, 0.112172, 0.062053, 0.04534599999999999, 0.026253000000000002, 0.01432, 0.014320999999999999, 0.019094, 0.011933000000000001, 0.009547, 0.009546, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.021480000000000003 }
        };




//        POR PERIODO E SEMESTRE
        double probDeEvasaoPeriodoSemestre [3][10][21] = {
                {
                    { 0.1261, 0.1011, 0.0533, 0.0391, 0.0174, 0.012, 0.0054, 0.0022, 0.0011, 0.0022, 0, 0.0011, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0.0163, 0.0261, 0.0239, 0.0413, 0.0217, 0.0196, 0.0109, 0.0065, 0.0043, 0, 0, 0.0011, 0.0011, 0, 0.0011, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.0043, 0.0065, 0.012, 0.012, 0.0152, 0.0098, 0.0033, 0.0043, 0.0011, 0.0011, 0.0033, 0.0011, 0.0011, 0, 0.0011, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.0022, 0.0065, 0.0054, 0.0054, 0.0043, 0.0022, 0.0054, 0.0011, 0.0011, 0, 0.0011, 0, 0, 0.0011, 0.0011, 0, 0, 0, 0 },
                    { 0, 0, 0, 0.0011, 0.0011, 0.0022, 0.0011, 0, 0.0043, 0.0033, 0.0011, 0.0022, 0.0011, 0.0011, 0.0011, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.0022, 0.0022, 0.0033, 0.0054, 0.0011, 0.0022, 0.0033, 0, 0.0011, 0.0022, 0.0011, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0.0011, 0, 0, 0.0011, 0.0011, 0.0022, 0.0033, 0.0022, 0, 0.0022, 0.0011, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0.0011, 0.0022, 0.0011, 0.0011, 0, 0, 0, 0, 0, 0, 0.0011, 0.0011, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0011, 0.0011, 0.0011, 0, 0.0022, 0, 0, 0.0011, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0011, 0.0011, 0.0011, 0.0011, 0 }
                },
                {
                    { 0.1218, 0.1018, 0.0639, 0.0319, 0.014, 0.012, 0.004, 0.002, 0.002, 0.002, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0.016, 0.024, 0.0299, 0.0339, 0.014, 0.022, 0.004, 0.004, 0.004, 0, 0, 0.002, 0, 0, 0.002, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.008, 0.006, 0.02, 0.01, 0.01, 0.012, 0, 0.006, 0.002, 0.002, 0.002, 0.002, 0.002, 0, 0.002, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.002, 0.008, 0.008, 0.008, 0.004, 0.002, 0.01, 0.002, 0.002, 0, 0.002, 0, 0, 0.002, 0.002, 0, 0, 0, 0 },
                    { 0, 0, 0, 0.002, 0.002, 0.004, 0.002, 0, 0.008, 0.004, 0.002, 0.002, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.004, 0.004, 0.004, 0.004, 0, 0.002, 0.004, 0, 0, 0.002, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0.002, 0, 0, 0, 0.002, 0.004, 0.004, 0.002, 0, 0.002, 0.002, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0.002, 0.004, 0.002, 0.002, 0, 0, 0, 0, 0, 0, 0.002, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.002, 0.002, 0.002, 0, 0.004, 0, 0, 0.002, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.002, 0.002, 0.002, 0.002, 0 }
                },
                {
                    { 0.1313, 0.1002, 0.0406, 0.0477, 0.0215, 0.0119, 0.0072, 0.0024, 0, 0.0024, 0, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0.0167, 0.0286, 0.0167, 0.0501, 0.031, 0.0167, 0.0191, 0.0095, 0.0048, 0, 0, 0, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.0072, 0.0024, 0.0143, 0.0215, 0.0072, 0.0072, 0.0024, 0, 0, 0.0048, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.0024, 0.0048, 0.0024, 0.0024, 0.0048, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0024, 0, 0.0024, 0.0024, 0.0024, 0.0024, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0024, 0.0072, 0.0024, 0.0024, 0.0024, 0, 0.0024, 0.0024, 0.0024, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0024, 0, 0, 0.0024, 0.0024, 0, 0.0024, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0024, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
                }
        };


        double probDeRetencaoPeriodoSemestre [3][10][21] = {
                {
                    { 0.2685, 0.0957, 0.0022, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0196 },
                    { 0.0011, 0.1522, 0.0239, 0.0065, 0.0022, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.0022, 0.0804, 0.0152, 0.0011, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.0011, 0.0109, 0.0272, 0.0152, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0.0033, 0.0152, 0.0098, 0, 0.0011, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0.0011, 0.0098, 0.0054, 0.0011, 0.0011, 0, 0.0011, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0.0054, 0.0043, 0.0043, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.0065, 0.0033, 0.0033, 0.0022, 0.0033, 0.0022, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.0011, 0.0054, 0.0065, 0.0033, 0.0011, 0.0022, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0076, 0.0054, 0.0054, 0.0022, 0.0033, 0.0011, 0, 0, 0, 0, 0, 0, 0 }
                },
                {
                    { 0.3214, 0.0619, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.018 },
                    { 0.002, 0.1637, 0.018, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.004, 0.0858, 0.008, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0.002, 0.018, 0.0319, 0.008, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0.004, 0.016, 0.002, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0.002, 0.012, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0.01, 0.006, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.012, 0.006, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.002, 0.01, 0.004, 0, 0.002, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.014, 0.01, 0.01, 0.004, 0.006, 0.002, 0, 0, 0, 0, 0, 0, 0 }
                },
                {
                    { 0.2053, 0.136, 0.0048, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0215 },
                    { 0, 0.1384, 0.031, 0.0143, 0.0048, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.074, 0.0239, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0.0024, 0.0215, 0.0239, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0.0024, 0.0143, 0.0191, 0, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0.0072, 0.0119, 0.0024, 0.0024, 0, 0.0024, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0.0024, 0.0095, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0072, 0.0048, 0.0072, 0.0048, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0.0095, 0.0072, 0, 0.0048, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
                    { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }
                }
        };

        virtual void initialize() override;
        virtual void handleMessage(cMessage *msg) override;
        virtual void finish() override;
};


#endif
